name: Test upload To Azure Blob Storage and Structurizr Cloud push

on:
  push:
    branches:
      - main

jobs:
  upload-coredsl-to-blob-storage:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/blob-storage-upload
        with:
          source_file: dsl/bic/core.dsl
          container_name: test-container
          connection_string: ${{ secrets.CONNECTION_STRING }}
          overwrite: 'true'

  push-workspace-to-structurizr-cloud:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: aidmax/structurizr-cli-action@v1
        with:
          id: ${{ secrets.STRUCTURIZR_WORKSPACE_ID }}
          key: ${{ secrets.STRUCTURIZR_API_KEY }}
          secret: ${{ secrets.STRUCTURIZR_API_SECRET }}
          workspace: dsl/bic/workspace.dsl

